var global=this;!function(t,o){"use strict";o.module("angularQuickDialog",["angularQuickDialog.template"]).factory("$quickDialog",function(){function t(t){this.isVisible=!1,this.name=t}function o(t){c[t].open()}function e(t){t=t||u.getTop().name,c[t].close()}function n(o){return c[o]=new t(o),c[o]}function i(){c={},u.clear()}var c={},u={stack:[],top:0,push:function(t){this.stack[this.top++]=t},pop:function(){return this.stack[--this.top]},getTop:function(){return this.stack[this.top-1]},clear:function(){this.top=0}};return t.prototype.open=function(){this.isVisible=!0,u.push(this)},t.prototype.close=function(){console.trace(),console.log("top before pop:",u.top),this.isVisible&&u.pop(),this.isVisible=!1,console.log("top after pop:",u.top)},global.d=function(){console.log("top dialog",u.getTop().name)},{open:o,close:e,create:n,reset:i}}).directive("quickDialog",["$timeout","$quickDialog",function(e,n){return{restrict:"EA",templateUrl:"template/quick-dialog.html",scope:{},transclude:!0,link:function(i,c,u){function a(){h=h||document.activeElement,f.append(p),p.bind("click",r),g.bind("keydown",s),e(function(){m.focus()})}function l(){g.unbind("keydown",s),p.unbind("click",r),p.remove(),e(function(){i.dialog.close()}),null!==h&&(h.focus(),h=k)}function s(t){t.keyCode===d&&(t.preventDefault(),l())}function r(t){t.stopPropagation(),l()}var p=o.element(document.createElement("div")).addClass("quick-dialog__backdrop"),d=27,f=o.element(document.body),g=o.element(t),m=document.getElementById(u.autoFocus)||c[0],h=document.getElementById(u.exitFocus),k=document.getElementById(u.exitFocus);try{i.dialog=n.create(u.dialogName)}catch(b){throw new Error("Dialog needs a name.")}var y=!0;i.$watch("dialog.isVisible",function(t){y||(t?a():l()),y=!1}),i.$on("$routeChangeStart",function(){n.reset()})}}}])}(window,window.angular);