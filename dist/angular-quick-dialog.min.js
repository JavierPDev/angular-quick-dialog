!function(t){try{t=angular.module("angularQuickDialog.template")}catch(o){t=angular.module("angularQuickDialog.template",[])}t.run(["$templateCache",function(t){t.put("template/quick-dialog.html",'<div class="quick-dialog" ng-show="dialog.isVisible"><span class="quick-dialog__close" ng-click="dialog.close()">x</span><div class="quick-dialog__content" ng-transclude></div></div>')}])}();var global=this;!function(t,o){"use strict";o.module("angularQuickDialog",["angularQuickDialog.template"]).factory("$quickDialog",function(){function t(t){this.isVisible=!1,this.name=t}function o(t){c[t].open()}function e(t){t=t||a.getTop().name,c[t].close()}function n(o){return c[o]=new t(o),c[o]}function i(){c={},a.clear()}var c={},a={stack:[],top:0,push:function(t){this.stack[this.top++]=t},pop:function(){return this.stack[--this.top]},getTop:function(){return this.stack[this.top-1]},clear:function(){this.top=0}};return t.prototype.open=function(){this.isVisible=!0,a.push(this)},t.prototype.close=function(){console.trace(),console.log("top before pop:",a.top),this.isVisible&&a.pop(),this.isVisible=!1,console.log("top after pop:",a.top)},global.d=function(){console.log("top dialog",a.getTop().name)},{open:o,close:e,create:n,reset:i}}).directive("quickDialog",["$timeout","$quickDialog",function(e,n){return{restrict:"EA",templateUrl:"template/quick-dialog.html",scope:{},transclude:!0,link:function(i,c,a){function l(){h=h||document.activeElement,g.append(d),d.bind("click",r),m.bind("keydown",s),e(function(){f.focus()})}function u(){m.unbind("keydown",s),d.unbind("click",r),d.remove(),e(function(){i.dialog.close()}),null!==h&&(h.focus(),h=k)}function s(t){t.keyCode===p&&(t.preventDefault(),u())}function r(t){t.stopPropagation(),u()}var d=o.element(document.createElement("div")).addClass("quick-dialog__backdrop"),p=27,g=o.element(document.body),m=o.element(t),f=document.getElementById(a.autoFocus)||c[0],h=document.getElementById(a.exitFocus),k=document.getElementById(a.exitFocus);try{i.dialog=n.create(a.dialogName)}catch(b){throw new Error("Dialog needs a name.")}var v=!0;i.$watch("dialog.isVisible",function(t){v||(t?l():u()),v=!1}),i.$on("$routeChangeStart",function(){n.reset()})}}}])}(window,window.angular);